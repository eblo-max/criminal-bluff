<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="format-detection" content="telephone=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="MobileOptimized" content="176">
  <meta name="HandheldFriendly" content="True">
  <meta name="robots" content="noindex, nofollow">
  <title>–ö—Ä–∏–º–∏–Ω–∞–ª—å–Ω—ã–π –ë–ª–µ—Ñ</title>
  <meta name="description" content="–î–µ—Ç–µ–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞, –≥–¥–µ –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∞–≤–¥—É —Å—Ä–µ–¥–∏ –ª–∂–∏">
  <link rel="icon" href="src/assets/favicon.ico">
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="src/styles/main.css">
  <!-- –®—Ä–∏—Ñ—Ç—ã -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Telegram WebApp -->
  <script>
    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    window.appStartTime = Date.now();
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å —Å –æ—Ç–º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏
    function logWithTime(message, obj) {
      const timeElapsed = Date.now() - window.appStartTime;
      const formattedTime = `+${timeElapsed}ms`;
      if (obj) {
        console.log(`${formattedTime} | ${message}`, obj);
      } else {
        console.log(`${formattedTime} | ${message}`);
      }
    }
    
    // –í–∫–ª—é—á–∞–µ–º debug_mode –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    if (window.location.search.includes('debug=1')) {
      localStorage.setItem('debug_mode', 'true');
      logWithTime('Debug mode –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
    }
    
    // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    window.diagnostics = {
      errors: [],
      warnings: [],
      events: [],
      telegramInfo: null
    };
    
    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤
    const originalConsoleError = console.error;
    console.error = function() {
      window.diagnostics.errors.push({
        time: new Date().toISOString(),
        arguments: Array.from(arguments).map(arg => 
          typeof arg === 'object' ? JSON.stringify(arg) : arg
        ).join(' ')
      });
      return originalConsoleError.apply(console, arguments);
    };
    
    const originalConsoleWarn = console.warn;
    console.warn = function() {
      window.diagnostics.warnings.push({
        time: new Date().toISOString(),
        arguments: Array.from(arguments).map(arg => 
          typeof arg === 'object' ? JSON.stringify(arg) : arg
        ).join(' ')
      });
      return originalConsoleWarn.apply(console, arguments);
    };
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ WebApp
    document.addEventListener('DOMContentLoaded', function() {
      logWithTime('DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Telegram WebApp
      if (window.Telegram && window.Telegram.WebApp) {
        const tg = window.Telegram.WebApp;
        window.diagnostics.telegramInfo = {
          available: true,
          version: tg.version,
          platform: tg.platform,
          viewportHeight: tg.viewportHeight,
          viewportStableHeight: tg.viewportStableHeight,
          headerColor: tg.headerColor,
          backgroundColor: tg.backgroundColor,
          initDataUnsafe: tg.initDataUnsafe ? '–î–æ—Å—Ç—É–ø–Ω–æ' : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
          initData: tg.initData ? tg.initData.substring(0, 50) + '...' : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ'
        };
        logWithTime('Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω', window.diagnostics.telegramInfo);
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –¥–µ–±–∞–≥-–ø–∞–Ω–µ–ª–∏
        updateDebugPanel();
      } else {
        window.diagnostics.telegramInfo = {
          available: false,
          error: 'Telegram WebApp –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω'
        };
        logWithTime('Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!');
        updateDebugPanel();
      }
    });
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–µ–±–∞–≥-–ø–∞–Ω–µ–ª–∏
    function updateDebugPanel() {
      const debugPanel = document.getElementById('debug-panel');
      if (!debugPanel) return;
      
      const telegramInfo = window.diagnostics.telegramInfo;
      if (!telegramInfo) {
        debugPanel.innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</p>';
        return;
      }
      
      let html = `<h3>Telegram WebApp: ${telegramInfo.available ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}</h3>`;
      
      if (telegramInfo.available) {
        html += `
          <ul>
            <li>–í–µ—Ä—Å–∏—è: ${telegramInfo.version}</li>
            <li>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${telegramInfo.platform}</li>
            <li>Viewport –≤—ã—Å–æ—Ç–∞: ${telegramInfo.viewportHeight}px</li>
            <li>InitData: ${telegramInfo.initData || '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ'}</li>
          </ul>
        `;
      } else {
        html += `<p>–û—à–∏–±–∫–∞: ${telegramInfo.error}</p>`;
      }
      
      html += `<h3>–û—à–∏–±–∫–∏ (${window.diagnostics.errors.length}):</h3>`;
      if (window.diagnostics.errors.length > 0) {
        html += '<ul>';
        window.diagnostics.errors.slice(-5).forEach(error => {
          html += `<li>${error.time}: ${error.arguments}</li>`;
        });
        html += '</ul>';
      } else {
        html += '<p>–ù–µ—Ç –æ—à–∏–±–æ–∫</p>';
      }
      
      debugPanel.innerHTML = html;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ–±–∞–≥-–ø–∞–Ω–µ–ª—å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
    setInterval(updateDebugPanel, 2000);
    
    // –õ–æ–≤–∏–º –≤—Å–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏
    window.onerror = function(message, source, lineno, colno, error) {
      console.error('Global error:', message, source, lineno, colno);
      return false;
    };
  </script>
</head>
<body>
  <div class="app">
    <!-- –ó–∞—Å—Ç–∞–≤–∫–∞ -->
    <div class="splash-screen">
      <div class="splash-logo">
        <img src="src/assets/logo.svg" alt="–ö—Ä–∏–º–∏–Ω–∞–ª—å–Ω—ã–π –ë–ª–µ—Ñ">
      </div>
      <h1 class="splash-title">–ö—Ä–∏–º–∏–Ω–∞–ª—å–Ω—ã–π –ë–ª–µ—Ñ</h1>
      <p class="splash-subtitle">–¢–µ—Å—Ç –Ω–∞ –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</p>
    </div>

    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="screen" id="start-screen">
      <div class="start-content">
        <h1 class="app-title">–ö—Ä–∏–º–∏–Ω–∞–ª—å–Ω—ã–π –ë–ª–µ—Ñ</h1>
        <p class="app-description">–ù–∞–π–¥–∏ –æ—à–∏–±–∫–∏ –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏—è—Ö</p>
        <div class="button-container">
          <button class="btn btn-primary" id="start-game-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
          <button class="btn btn-secondary" id="profile-btn">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</button>
          <button class="btn btn-secondary" id="leaderboard-btn">–†–µ–π—Ç–∏–Ω–≥</button>
        </div>
      </div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div class="screen" id="game-screen">
      <div class="game-header">
        <div class="timer">
          <div class="timer-bar"></div>
          <div class="timer-text">15</div>
        </div>
        <div class="progress">
          <span class="current-question">1</span>/<span class="total-questions">5</span>
        </div>
        <div class="streak">
          <span class="streak-count">0</span>
          <span class="streak-icon">üî•</span>
        </div>
      </div>
      <div class="story-container">
        <p class="story-text"></p>
      </div>
      <div class="options-container">
        <button class="option" data-index="0"></button>
        <button class="option" data-index="1"></button>
        <button class="option" data-index="2"></button>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ—Ç–≤–µ—Ç–∞ -->
    <div class="screen" id="answer-result-screen">
      <div class="result-container">
        <div class="result-header">
          <div class="result-icon"></div>
          <h2 class="result-title"></h2>
        </div>
        <div class="explanation-container">
          <p class="explanation-text"></p>
        </div>
        <div class="score-info">
          <div class="score-item">
            <span class="score-label">–û—á–∫–∏:</span>
            <span class="score-value"></span>
          </div>
          <div class="score-item">
            <span class="score-label">–°–µ—Ä–∏—è:</span>
            <span class="streak-value"></span>
          </div>
        </div>
        <button class="btn btn-primary next-btn">–°–ª–µ–¥—É—é—â–∞—è –∏—Å—Ç–æ—Ä–∏—è</button>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–≥—Ä—ã -->
    <div class="screen" id="game-result-screen">
      <div class="game-result-container">
        <h2 class="result-heading">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
        <div class="result-stats">
          <div class="stat-item">
            <div class="stat-value" id="correct-answers">0</div>
            <div class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="total-score">0</div>
            <div class="stat-label">–û—á–∫–æ–≤ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="best-streak">0</div>
            <div class="stat-label">–õ—É—á—à–∞—è —Å–µ—Ä–∏—è</div>
          </div>
        </div>
        <div class="result-actions">
          <button class="btn btn-primary" id="play-again-btn">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
          <button class="btn btn-secondary" id="share-result-btn">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="screen" id="profile-screen">
      <div class="profile-header">
        <button class="back-btn" id="profile-back-btn">
          <span class="back-icon">‚Üê</span>
        </button>
        <h2 class="screen-title">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
      </div>
      <div class="profile-container">
        <div class="user-info">
          <div class="user-avatar">
            <img src="src/assets/default-avatar.svg" alt="Avatar" id="user-avatar">
          </div>
          <div class="user-name" id="user-name"></div>
        </div>
        <div class="stats-container">
          <div class="stat-row">
            <div class="stat-label">–í—Å–µ–≥–æ –∏–≥—Ä:</div>
            <div class="stat-value" id="games-played">0</div>
          </div>
          <div class="stat-row">
            <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –≤–µ—Ä–Ω—ã—Ö:</div>
            <div class="stat-value" id="accuracy">0%</div>
          </div>
          <div class="stat-row">
            <div class="stat-label">–õ—É—á—à–∞—è —Å–µ—Ä–∏—è:</div>
            <div class="stat-value" id="profile-best-streak">0</div>
          </div>
          <div class="stat-row">
            <div class="stat-label">–í —Ä–µ–π—Ç–∏–Ω–≥–µ:</div>
            <div class="stat-value" id="rank-position">#0</div>
          </div>
        </div>
        <div class="achievements-container">
          <h3 class="section-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
          <div class="achievements-list" id="achievements-list">
            <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </div>
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
    <div class="screen" id="leaderboard-screen">
      <div class="leaderboard-header">
        <button class="back-btn" id="leaderboard-back-btn">
          <span class="back-icon">‚Üê</span>
        </button>
        <h2 class="screen-title">–†–µ–π—Ç–∏–Ω–≥</h2>
      </div>
      <div class="leaderboard-tabs">
        <button class="tab-btn active" data-period="daily">–°–µ–≥–æ–¥–Ω—è</button>
        <button class="tab-btn" data-period="weekly">–ù–µ–¥–µ–ª—è</button>
        <button class="tab-btn" data-period="all-time">–ó–∞ –≤—Å–µ –≤—Ä–µ–º—è</button>
      </div>
      <div class="leaderboard-container">
        <div class="leaderboard-list" id="leaderboard-list">
          <!-- –ó–∞–ø–∏—Å–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        <div class="neighbors-container" id="neighbors-container">
          <h3 class="section-title">–í–∞—à–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ</h3>
          <div class="neighbors-list" id="neighbors-list">
            <!-- –°–æ—Å–µ–¥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </div>
        </div>
      </div>
      <div class="user-rank-container">
        <div class="user-rank-label">–í–∞—à–∞ –ø–æ–∑–∏—Ü–∏—è:</div>
        <div class="user-rank-value" id="user-rank">#0</div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Sentry -->
    <div class="screen" id="sentry-test-screen">
      <div class="sentry-test-header">
        <button class="back-btn" id="sentry-test-back-btn">
          <span class="back-icon">‚Üê</span>
        </button>
        <h2 class="screen-title">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Sentry</h2>
      </div>
      <div class="sentry-test-container">
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ SentryTest.js -->
      </div>
    </div>
  </div>

  <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å (–≤–∏–¥–∏–º–∞ —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏) -->
  <div id="debug-panel" class="debug-panel" style="display:none;"></div>

  <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ debug-—Ä–µ–∂–∏–º–∞ (–Ω–µ–≤–∏–¥–∏–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
  <div id="debug-toggle" class="debug-toggle" onclick="activateDebugMode()"></div>

  <!-- JS -->
  <script type="module" src="src/app.js"></script>
  <script>
    // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –ø–∞–Ω–µ–ª—å –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
    if (localStorage.getItem('debug_mode') === 'true') {
      document.getElementById('debug-panel').style.display = 'block';
      logWithTime('–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
    }

    // –§—É–Ω–∫—Ü–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ debug-—Ä–µ–∂–∏–º–∞
    function activateDebugMode() {
      localStorage.setItem('debug_mode', 'true');
      
      // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –ø–∞–Ω–µ–ª—å
      const debugPanel = document.getElementById('debug-panel');
      if (debugPanel) {
        debugPanel.style.display = 'block';
      }
      
      // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º debug
      const currentUrl = new URL(window.location.href);
      currentUrl.searchParams.set('debug', '1');
      window.location.href = currentUrl.toString();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∂–µ—Å—Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
    function setupDebugGesture() {
      let taps = 0;
      let lastTap = 0;
      
      // –ü—Ä–∏ 5 –±—ã—Å—Ç—Ä—ã—Ö –Ω–∞–∂–∞—Ç–∏—è—Ö –Ω–∞ –ª–æ–≥–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –æ—Ç–ª–∞–¥–∫—É
      document.querySelector('.splash-logo').addEventListener('click', function(e) {
        const curTime = new Date().getTime();
        const tapTime = curTime - lastTap;
        
        if (tapTime < 500 && tapTime > 0) {
          taps++;
          if (taps >= 5) {
            activateDebugMode();
            taps = 0;
          }
        } else {
          taps = 1;
        }
        
        lastTap = curTime;
      });
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∂–µ—Å—Ç–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', setupDebugGesture);
  </script>
</body>
</html> 