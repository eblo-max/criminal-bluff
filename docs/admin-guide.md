# Руководство администратора Criminal Bluff

Это руководство для администраторов мини-приложения Telegram "Криминальный Блеф". Руководство описывает основные функции административной панели и процессы управления приложением.

## Содержание

1. [Доступ к административной панели](#доступ-к-административной-панели)
2. [Управление историями](#управление-историями)
3. [Управление пользователями](#управление-пользователями)
4. [Управление рейтингами](#управление-рейтингами)
5. [Просмотр статистики](#просмотр-статистики)
6. [Настройка системы](#настройка-системы)
7. [Обслуживание и устранение неполадок](#обслуживание-и-устранение-неполадок)

## Доступ к административной панели

### Предоставление прав администратора

1. Права администратора управляются через переменную окружения `ADMIN_TELEGRAM_ID`.
2. Добавьте Telegram ID пользователя в эту переменную в файле `.env` для назначения его администратором.
3. После перезапуска сервера пользователь получит права администратора.

### Вход в панель администратора

1. Перейдите по адресу: `https://your-domain.com/admin`
2. Авторизуйтесь через Telegram (появится кнопка авторизации)
3. После успешной авторизации вы получите доступ к административной панели

## Управление историями

### Добавление новой истории

1. Перейдите в раздел "Истории"
2. Нажмите на кнопку "Добавить историю"
3. Заполните форму:
   - **Текст истории**: основной текст криминальной истории
   - **Варианты ответов**: три варианта, один из которых является правильным
   - **Правильный ответ**: выберите номер правильного варианта
   - **Объяснение**: объяснение, почему этот ответ правильный
   - **Сложность**: выберите уровень сложности (легкий, средний, сложный)
   - **Категория**: выберите категорию истории
4. Нажмите "Сохранить"

### Редактирование истории

1. В списке историй найдите нужную историю
2. Нажмите иконку редактирования
3. Внесите необходимые изменения
4. Нажмите "Сохранить"

### Удаление истории

1. В списке историй найдите нужную историю
2. Нажмите иконку удаления
3. Подтвердите удаление в диалоговом окне

## Управление пользователями

### Просмотр пользователей

1. Перейдите в раздел "Пользователи"
2. Используйте фильтры для поиска конкретных пользователей

### Просмотр информации о пользователе

1. Нажмите на имя пользователя в списке
2. Просмотрите подробную информацию: статистику игр, достижения и т.д.

### Блокировка пользователя

1. В профиле пользователя нажмите на кнопку "Заблокировать"
2. Подтвердите действие в диалоговом окне

### Сброс пароля пользователя

1. В профиле пользователя нажмите на кнопку "Сбросить пароль"
2. Пользователю будет отправлена ссылка для восстановления пароля на указанный email

## Управление рейтингами

### Просмотр рейтингов

1. Перейдите в раздел "Рейтинги"
2. Выберите тип рейтинга: глобальный, недельный или дневной

### Сброс рейтинга

1. В выбранном рейтинге нажмите кнопку "Сбросить рейтинг"
2. Выберите тип рейтинга для сброса (дневной, недельный или глобальный)
3. Подтвердите действие

> **Внимание!** Сброс глобального рейтинга приведет к обнулению счета всех пользователей. Это действие нельзя отменить.

### Восстановление рейтингов

Если данные рейтингов были повреждены, вы можете восстановить их на основе истории игр:

1. Перейдите в раздел "Рейтинги"
2. Нажмите кнопку "Восстановить рейтинги"
3. Подтвердите действие

Система автоматически восстановит все рейтинги на основе истории игр пользователей.

## Просмотр статистики

### Общая статистика

1. Перейдите в раздел "Статистика"
2. На главной странице отображаются основные показатели:
   - Количество активных пользователей
   - Количество игр за сегодня/неделю/всё время
   - Средний счет пользователей
   - График активности

### Статистика пользователей

1. Перейдите в раздел "Статистика" > "Пользователи"
2. Здесь вы найдете информацию о:
   - Новых регистрациях
   - Активности пользователей
   - Распределении пользователей по странам

### Статистика игр

1. Перейдите в раздел "Статистика" > "Игры"
2. Здесь вы найдете информацию о:
   - Количестве сыгранных игр
   - Успешности ответов
   - Популярных историях

## Настройка системы

### Изменение настроек игры

Настройки игры хранятся в переменных окружения. Для их изменения:

1. Отредактируйте файл `.env` в корне проекта
2. Перезапустите сервер для применения изменений

### Основные настройки:

- `ADMIN_TELEGRAM_ID` - Telegram ID администратора
- `JWT_SECRET` - Секретный ключ для JWT токенов
- `JWT_EXPIRATION` - Время жизни JWT токенов
- `RATE_LIMIT_WINDOW_MS` - Окно для ограничения запросов (в мс)
- `RATE_LIMIT_MAX` - Максимальное количество запросов в окне

## Обслуживание и устранение неполадок

### Мониторинг сервера

1. Проверьте логи сервера в разделе "Системная информация"
2. Следите за метриками использования ресурсов

### Резервное копирование

Резервное копирование базы данных выполняется автоматически каждый день. Для ручного создания резервной копии:

1. Перейдите в раздел "Система" > "Резервное копирование"
2. Нажмите "Создать резервную копию"

### Восстановление из резервной копии

1. Перейдите в раздел "Система" > "Резервное копирование"
2. Выберите нужную резервную копию из списка
3. Нажмите "Восстановить"
4. Подтвердите действие

### Общие проблемы и их решения

#### Проблема: Пользователи не могут авторизоваться через Telegram

**Решение:**
1. Проверьте настройки Telegram бота
2. Убедитесь, что переменные окружения `TELEGRAM_BOT_TOKEN` и `TELEGRAM_WEBHOOK_DOMAIN` установлены правильно
3. Проверьте логи сервера на предмет ошибок

#### Проблема: Рейтинги не обновляются

**Решение:**
1. Проверьте подключение к Redis
2. Убедитесь, что переменная окружения `REDIS_URL` установлена правильно
3. Перезапустите сервер
4. При необходимости выполните "Восстановление рейтингов"

#### Проблема: Административная панель недоступна

**Решение:**
1. Убедитесь, что ваш Telegram ID добавлен в `ADMIN_TELEGRAM_ID`
2. Проверьте сетевые настройки и доступность сервера
3. Очистите кэш браузера и cookies, затем попробуйте снова

## Контакты поддержки

При возникновении проблем, которые не удается решить самостоятельно, обратитесь в службу поддержки:

- Email: support@criminalbluff.com
- Telegram: @CriminalBluffSupport 